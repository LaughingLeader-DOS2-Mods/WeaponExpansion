Version 1
SubGoalCombiner SGC_AND
INITSECTION
KBSECTION

//REGION UNIQUE_SHIELDS
PROC
LLWEAPONEX_OnItemTemplateEquipped((CHARACTERGUID)_Char, (ITEMGUID)_Item, "WPN_UNIQUE_LLWEAPONEX_Shield_DualShields_GiantDoor_A_5e8ca310-616d-4f18-b455-e510dade5b62")
AND
ObjectGetFlag(_Item, "LLWEAPONEX_DualShields_GeneratedCombatShield", 0)
AND
GetPosition(_Char, _x, _y, _z)
AND
CreateItemTemplateAtPosition("WPN_UNIQUE_LLWEAPONEX_CombatShield_GiantDoor_A_b4748a58-427c-4652-bf6c-d596ddcc134d", _x, _y, _z, _CombatShield)
AND
CharacterGetLevel(_Char, _Level)
THEN
ObjectSetFlag(_Item, "LLWEAPONEX_DualShields_GeneratedCombatShield", 0);
SetTag(_CombatShield, "LLWEAPONEX_Debug_StorableCombatShield");
SetVarObject(_Item, "LLWEAPONEX_CombatShield", _CombatShield);

SetVarObject(_CombatShield, "LLWEAPONEX_ParentDualShield", _Item);
SetVarFixedString(_CombatShield, "LeaderLib_Rarity", "Unique");
ItemSetOwner(_CombatShield, _Char);

ItemLevelUpTo(_Item, _Level);
ItemLevelUpTo(_CombatShield, _Level);
SetVarInteger(_Item, "LeaderLib_Level", _Level);
SetVarInteger(_CombatShield, "LeaderLib_Level", _Level);

ItemToInventory(_CombatShield, _Item, 1, 0, 0);
//END_REGION

//REGION CC_PRESET_FIX
/*
//Post-CC Preset Fix
PROC
LLWEAPONEX_OnCharacterCreationFinished((CHARACTERGUID)_Char)
AND
CharacterGetEquippedItem(_Char, "Shield", (ITEMGUID)_Shield)
AND
_Shield != NULL_00000000-0000-0000-0000-000000000000
AND
IsTagged(_Shield, "LLWEAPONEX_DualShields", 1)
AND
ObjectGetFlag(_Shield, "LLWEAPONEX_DualShields_GeneratedCombatShield", _GeneratedShield)
THEN
LLWEAPONEX_DualShields_OnDualShieldEquipped(_Char, _Shield, _GeneratedShield);
*/
//END_REGION

//REGION HUNKER_DOWN
IF
CharacterStatusApplied(_Char, "LLWEAPONEX_DUALSHIELDS_HUNKER_DOWN", _)
THEN
LeaderLib_ToggleScripts_EnableScriptForObject(_Char, "LLWEAPONEX_DualShields_HunkeringDown", "WeaponExpansion");

IF
CharacterStatusApplied(_Char, "LLWEAPONEX_DUALSHIELDS_HUNKER_DOWN", _)
AND
IsTagged(_Char, "AI_PREFERRED_TARGET", 0)
THEN
SetTag(_Char, "AI_PREFERRED_TARGET");
DB_LLWEAPONEX_DualShields_Temp_AddedAITag(_Char);

IF
CharacterStatusRemoved(_Char, "LLWEAPONEX_DUALSHIELDS_HUNKER_DOWN", _)
AND
DB_LLWEAPONEX_DualShields_Temp_AddedAITag(_Char)
THEN
NOT DB_LLWEAPONEX_DualShields_Temp_AddedAITag(_Char);
ClearTag(_Char, "AI_PREFERRED_TARGET");

IF
CharacterStatusRemoved(_Char, "LLWEAPONEX_DUALSHIELDS_HUNKER_DOWN", _)
THEN
LeaderLib_ToggleScripts_DisableScriptForObjectAfterDelay(_Char, "LLWEAPONEX_DualShields_HunkeringDown", "WeaponExpansion", 500);
SetStoryEvent(_Char, "LLWEAPONEX_DualShields_RemoveHunkerDownAnimationOverride");
//END_REGION

//REGION SHIELD_COVER
IF
CharacterStatusRemoved(_Char, "LLWEAPONEX_COVERED", _)
AND
GetUUID(_Char, _UUID)
THEN
NRD_ModCall("WeaponExpansion", "DualShields_Cover_OnRemoved", _UUID);

IF
CharacterStatusApplied(_Char, "LLWEAPONEX_COVERED", (CHARACTERGUID)_Blocker)
AND GetUUID(_Char, _UUID)
AND GetUUID(_Blocker, _BlockerUUID)
THEN
NRD_ModCall("WeaponExpansion", "DualShields_Cover_OnApplied", _UUID, _BlockerUUID);
//END_REGION

//REGION IRON_MAIDEN
IF
CharacterStatusRemoved(_Char, "LLWEAPONEX_SHIELD_PRISON", _)
AND
HasActiveStatus(_Char, "LLWEAPONEX_SHIELD_PRISON_FX", 1)
THEN
ProcObjectTimerCancel(_Char, "LLWEAPONEX_Timers_RemoveShieldPrisonFX");
ProcObjectTimer(_Char, "LLWEAPONEX_Timers_RemoveShieldPrisonFX", 250);

PROC
ProcObjectTimerFinished((CHARACTERGUID)_Char, "LLWEAPONEX_Timers_RemoveShieldPrisonFX")
AND
HasActiveStatus(_Char, "LLWEAPONEX_SHIELD_PRISON_FX", 1)
THEN
RemoveStatus(_Char, "LLWEAPONEX_SHIELD_PRISON_FX");
LeaderLib_Timers_StartObjectTimer(_Char, 250, "LLWEAPONEX_Timers_PlayShieldPrisonEndFX", "LLWEAPONEX_PlayShieldPrisonEndFX");

IF
StoryEvent(_Char, "LLWEAPONEX_PlayShieldPrisonEndFX")
AND
HasActiveStatus(_Char, "LLWEAPONEX_IRONMAIDEN_SHIELDPRISON_FX", 0)
THEN
PlayEffect(_Char, "LLWEAPONEX_FX_Status_ShieldPrison_End_01", "Dummy_Root");

IF
CharacterPrecogDying(_Char)
AND
IsTagged(_Char, "LLWEAPONEX_IRONMAIDEN_BONUS", 1)
THEN
ClearTag(_Char, "LLWEAPONEX_IRONMAIDEN_BONUS");
//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "LLWEAPONEX_00_PostCC"